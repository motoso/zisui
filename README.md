# Book Organizer

本のスキャンファイルを適切な形式（表紙、001、002...）に自動整理するツール

## 機能

- **自動整理**: スキャンファイルを適切な順序で整理
- **表紙検出**: 表紙ファイルを自動識別
- **追加ページ対応**: 000_1、000_2のような追加・挿入ページファイルを適切に処理
- **ドライラン**: 実際の変更前にプレビュー
- **CBZ作成**: 整理後にCBZファイルを作成

## インストール

```bash
# リポジトリのクローン
git clone <repository-url>
cd book-organizer

# 依存関係のインストール
uv sync
```

## 使用方法

```bash
# 基本的な使用
uv run book-organizer /path/to/book

# ドライランモード
uv run book-organizer --dry-run /path/to/book

# 自動実行モード
uv run book-organizer --auto /path/to/book

# CBZ作成
uv run book-organizer --create-cbz /path/to/book
```

## ファイル構造

### 入力として想定するファイル構造

```
target_directory/
├── 漫画タイトル.jpg          # 表紙ファイル（オプション）
├── 漫画タイトル_000.jpg      # 特別ページ
├── 漫画タイトル_000_1.jpg    # 000の追加ページ
├── 漫画タイトル_000_2.jpg    # 000のさらなる追加ページ
├── 漫画タイトル_001.jpg      # 1ページ目
├── 漫画タイトル_002.jpg      # 2ページ目
├── 漫画タイトル_003.jpg      # 3ページ目
├── ...
├── 漫画タイトル_024.jpg      # 最終ページ
├── 漫画タイトル_025.jpg      # 表紙
└── 漫画タイトル_026.jpg      # 裏表紙
```

### 整理後のファイル構造

```
target_directory/
└── 漫画タイトル/
    ├── 漫画タイトル_001.jpg  # 表紙（元の025番）
    ├── 漫画タイトル_002.jpg  # 元の「タイトル.jpg」があればここに配置
    ├── 漫画タイトル_003.jpg  # 元の000番
    ├── 漫画タイトル_004.jpg  # 元の000_1番（000の次に配置）
    ├── 漫画タイトル_005.jpg  # 元の000_2番（000_1の次に配置）
    ├── 漫画タイトル_006.jpg  # 元の001番
    ├── 漫画タイトル_007.jpg  # 元の002番
    ├── 漫画タイトル_008.jpg  # 元の003番
    ├── ...
    ├── 漫画タイトル_028.jpg  # 元の024番（最終ページ）
    └── 漫画タイトル_029.jpg  # 裏表紙（元の026番）
```

### 表紙の扱い

- **表紙は連番ファイルの最後から2番目（例：025番）を使用**
- **裏表紙は連番ファイルの最後（例：026番）を使用**
- タイトルのみファイル（例：「タイトル.jpg」）がある場合は002番に配置
- 連番ファイルは2つ以上必要

### 追加ページ機能

000_1、000_2のような追加・挿入ページファイルに対応しています：

- **認識パターン**: `_数字` または `_数字_数字` で終わるファイル名
- **ソート順序**: 自然順序ソート（000 → 000_1 → 000_2 → 001...）
- **配置ルール**: 追加ページは基本番号の直後に挿入される
- **使用場面**: 後から追加したいページ、挿絵、補足ページなど

#### 例：
```
入力ファイル:
├── manga_000.jpg      → 003番に配置
├── manga_000_1.jpg    → 004番に配置（000の次に挿入）
├── manga_000_2.jpg    → 005番に配置（000_1の次に挿入）
├── manga_001.jpg      → 001番に配置（表紙）
└── manga_002.jpg      → 006番に配置
```

## サポートファイル形式

- JPEG (`.jpg`, `.jpeg`)
- PNG (`.png`)

## 開発

### テスト実行

```bash
uv run pytest
```

### テストカバレッジ

```bash
uv run pytest --cov=book_organizer
```

